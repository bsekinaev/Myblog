{% extends 'blog/base.html' %}

{% block content %}
<article>
    <h2>{{ post.title }}</h2>
    <p class="meta">
        <span>Автор: {{ post.author.username }}</span> |
        <span>Дата: {{ post.date_posted|date:"d M Y" }}</span>
    </p>
    <div class="content">
        {{ post.content|linebreaks }}
    </div>

    {% if user == post.author %}
    <div class="actions">
        <a href="{% url 'post-edit' pk=post.pk %}" class="btn btn-edit">Редактировать</a>
        <a href="{% url 'post-delete' pk=post.pk %}" class="btn btn-delete">Удалить</a>
    </div>
    {% endif %}
</article>
<a href="{% url 'blog-home' %}" class="btn">На главную</a>

<!-- ПЕРЕМЕЩАЕМ СЕКЦИЮ КОММЕНТАРИЕВ ВНУТРЬ БЛОКА CONTENT -->
<section class="comments">
    <h3>Комментарии ({{ comments.count }})</h3>

    {% if user.is_authenticated %}
    <form method="POST" class="comment-form">
        {% csrf_token %}
        {{ form.content }}
        <button type="submit">Отправить</button>
    </form>
    {% else %}
    <p><a href="{% url 'login' %}">Войдите</a>, чтобы оставить комментарий</p>
    {% endif %}

    <div class="comment-list">
        {% for comment in comments %}
        <div class="comment">
            <div class="comment-header">
                <span class="comment-author">{{ comment.author.username }}</span>
                <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>

                {% if comment.author == user or post.author == user %}
                <form method="POST" action="{% url 'comment-delete' comment.id %}" class="delete-comment-form">
                    {% csrf_token %}
                    <button type="submit" class="btn-delete">×</button>
                </form>
                {% endif %}
            </div>
            <p>{{ comment.content }}</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}